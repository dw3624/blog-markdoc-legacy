<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/c0b628ab48496dde.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c0b628ab48496dde.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-bc4ae192cef394bd.js" defer=""></script><script src="/_next/static/chunks/framework-839af705687712fa.js" defer=""></script><script src="/_next/static/chunks/main-28132e797e9512a4.js" defer=""></script><script src="/_next/static/chunks/pages/_app-f2548a56e30dbcef.js" defer=""></script><script src="/_next/static/chunks/605040ef-d91e3f03124f1fe4.js" defer=""></script><script src="/_next/static/chunks/pages/docs/220705-nfds-email-bot-faa35e1336c8388d.js" defer=""></script><script src="/_next/static/gXFg2fmxjtWa03NholGib/_buildManifest.js" defer=""></script><script src="/_next/static/gXFg2fmxjtWa03NholGib/_ssgManifest.js" defer=""></script><style id="__jsx-3251069789">a.jsx-3251069789{-webkit-text-decoration:none;text-decoration:none;}a.jsx-3251069789:hover{opacity:1;}div.jsx-3251069789{position:absolute;margin-top:-70px;}</style><style id="__jsx-1786922009">a.jsx-1786922009{color:black;-webkit-text-decoration:none;text-decoration:none;}a.jsx-1786922009:hover{opacity:1;}a.jsx-1786922009 .heading::after{opacity:0;color:var(--toc-border);content:'  #';-webkit-transition:opacity 250ms ease;transition:opacity 250ms ease;}a.jsx-1786922009 .heading:hover::after{opacity:1;}</style><style id="__jsx-4199775075">.icon.jsx-4199775075{display:inline-block;position:relative;font-size:inherit;width:1em;height:1em;min-width:16px;box-sizing:content-box;color:inherit;}.icon.jsx-4199775075 svg{z-index:10;position:relative;display:block;fill:currentcolor;stroke:currentcolor;width:100%;height:100%;}</style><style id="__jsx-831781359">.code.jsx-831781359{position:relative;}.code.jsx-831781359 button.jsx-831781359{-webkit-appearance:none;-moz-appearance:none;appearance:none;position:absolute;color:inherit;background:var(--code-background);top:13px;right:11px;border-radius:4px;border:none;font-size:15px;}pre.jsx-831781359{white-space:pre-wrap;}</style><style id="__jsx-2743484325">nav.jsx-2743484325{border-left:1px solid #dfdfdf;}ul.jsx-2743484325{margin:0;padding:0;}li.jsx-2743484325{list-style-type:none;margin:0 0 1rem 1.5rem;font-size:14px;font-weight:400;}li.jsx-2743484325 a.jsx-2743484325{-webkit-text-decoration:none;text-decoration:none;}li.jsx-2743484325 a.jsx-2743484325:hover,li.active.jsx-2743484325 a.jsx-2743484325{-webkit-text-decoration:underline;text-decoration:underline;}li.padded.jsx-2743484325{padding-left:1rem;}@media screen and (max-width:1000px){nav.jsx-2743484325{display:none;}}</style><style data-styled="" data-styled-version="5.3.6">.fuJDY{height:120px;width:100%;position:relative;bottom:null;background-color:var(--primary);z-index:2;}/*!sc*/
@media screen and (max-width:601px){.fuJDY{height:100px;}}/*!sc*/
data-styled.g1[id="Footer__Wrap-sc-ifmyi6-0"]{content:"fuJDY,"}/*!sc*/
.gBtbfS{height:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;gap:0.5rem;box-sizing:border-box;color:var(--dark);padding:1rem 0;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}/*!sc*/
data-styled.g2[id="Footer__Foot-sc-ifmyi6-1"]{content:"gBtbfS,"}/*!sc*/
.jmqRFP{text-align:center;font-size:13px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}/*!sc*/
data-styled.g3[id="Footer__Item-sc-ifmyi6-2"]{content:"jmqRFP,"}/*!sc*/
.kNkMPs{height:26px;font-size:var(--font-size-2);line-height:1.5rem;font-weight:700;background-color:var(--primary);border:1px solid transparent;padding:0 0.7rem;border-radius:100px;}/*!sc*/
data-styled.g4[id="tag__StyledTag-sc-17z8z5z-0"]{content:"kNkMPs,"}/*!sc*/
.eHjIcj{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:0.25rem;}/*!sc*/
data-styled.g5[id="tag__Wrap-sc-wv7zn5-0"]{content:"eHjIcj,"}/*!sc*/
.iOydMI{top:0;position:-webkit-sticky;position:sticky;z-index:1;width:100%;}/*!sc*/
data-styled.g6[id="TopNav__Header-sc-aybce4-0"]{content:"iOydMI,"}/*!sc*/
.bZchrV{width:100%;background-color:var(--primary);border-bottom:1px solid transparent;}/*!sc*/
data-styled.g7[id="TopNav__Nav-sc-aybce4-1"]{content:"bZchrV,"}/*!sc*/
.ktICUu{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:1rem;max-width:1280px;margin:0 auto;-webkit-align-items:flex-end;-webkit-box-align:flex-end;-ms-flex-align:flex-end;align-items:flex-end;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;padding:1rem 1.5rem 1.1rem;font-size:15px;font-family:var(--sans);}/*!sc*/
data-styled.g8[id="TopNav__NavContent-sc-aybce4-2"]{content:"ktICUu,"}/*!sc*/
.bnXMSm{font-size:25px;font-weight:700;-webkit-text-decoration:none;text-decoration:none;-webkit-transition:all 0.2s ease;transition:all 0.2s ease;}/*!sc*/
.bnXMSm:hover{color:var(--accent);-webkit-transform:scale(1.08);-ms-transform:scale(1.08);transform:scale(1.08);opacity:1;}/*!sc*/
data-styled.g9[id="TopNav__Logo-sc-aybce4-3"]{content:"bnXMSm,"}/*!sc*/
.kPhsbm{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;gap:1.3rem;padding:0;}/*!sc*/
@media screen and (max-width:600px){.kPhsbm{display:none;}}/*!sc*/
data-styled.g10[id="TopNav__Section-sc-aybce4-4"]{content:"kPhsbm,"}/*!sc*/
.bVwmPO{color:var(--dark);-webkit-text-decoration:none;text-decoration:none;font-weight:600;-webkit-transition:all .2s ease;transition:all .2s ease;}/*!sc*/
.bVwmPO:hover{color:var(--accent);-webkit-transform:translateY(-0.2rem);-ms-transform:translateY(-0.2rem);transform:translateY(-0.2rem);opacity:1;}/*!sc*/
.bVwmPO:active{color:var(--accent);-webkit-transform:translateY(0.2rem);-ms-transform:translateY(0.2rem);transform:translateY(0.2rem);}/*!sc*/
data-styled.g11[id="TopNav__MenuLink-sc-aybce4-5"]{content:"bVwmPO,"}/*!sc*/
.jzhnFu{color:var(--dark);width:48px;height:32px;border:0;border-radius:30px;background:none;}/*!sc*/
.jzhnFu:hover{color:var(--accent);-webkit-transform:translateY(-0.2rem);-ms-transform:translateY(-0.2rem);transform:translateY(-0.2rem);opacity:1;}/*!sc*/
@media screen and (min-width:601px){.jzhnFu{display:none;}}/*!sc*/
data-styled.g12[id="TopNav__MenuButton-sc-aybce4-6"]{content:"jzhnFu,"}/*!sc*/
.hgzrJE{height:auto;}/*!sc*/
data-styled.g14[id="_app__Wrap-sc-xx91a-0"]{content:"hgzrJE,"}/*!sc*/
.dzjNyc{margin:0 auto;padding-top:24px 24px 0;max-width:1280px;}/*!sc*/
data-styled.g15[id="_app__WrapPage-sc-xx91a-1"]{content:"dzjNyc,"}/*!sc*/
.gKXBvV{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;max-width:100vw;}/*!sc*/
data-styled.g16[id="_app__WrapMain-sc-xx91a-2"]{content:"gKXBvV,"}/*!sc*/
.iqkLbd{-webkit-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;min-width:0;padding:2rem 1.5rem 3rem;}/*!sc*/
data-styled.g17[id="_app__Main-sc-xx91a-3"]{content:"iqkLbd,"}/*!sc*/
.jecWPd{width:300px;position:-webkit-sticky;position:sticky;-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;top:2.5rem;max-height:calc(100vh - 100px);margin-bottom:1rem;padding:3rem 0 0 1rem;}/*!sc*/
@media screen and (max-width:1000px){.jecWPd{-webkit-flex:0;-ms-flex:0;flex:0;}}/*!sc*/
data-styled.g18[id="_app__ToC-sc-xx91a-4"]{content:"jecWPd,"}/*!sc*/
.HOFWV{font-size:var(--font-size-6);font-weight:600;}/*!sc*/
data-styled.g21[id="_app__Title-sc-xx91a-7"]{content:"HOFWV,"}/*!sc*/
.lhsOaa{padding-left:0.2rem;color:gray;font-size:var(--font-size-2);font-weight:600;}/*!sc*/
data-styled.g23[id="_app__Date-sc-xx91a-9"]{content:"lhsOaa,"}/*!sc*/
.jqpViC{margin:1rem 0 2rem;border-bottom:1px solid var(--gray-light);line-height:0.1em;opacity:0;}/*!sc*/
data-styled.g24[id="_app__Separator-sc-xx91a-10"]{content:"jqpViC,"}/*!sc*/
</style></head><body><div id="__next"><div class="_app__Wrap-sc-xx91a-0 hgzrJE"><header class="TopNav__Header-sc-aybce4-0 iOydMI"><nav class="TopNav__Nav-sc-aybce4-1 bZchrV"><div class="TopNav__NavContent-sc-aybce4-2 ktICUu"><a href="/" class="TopNav__Logo-sc-aybce4-3 bnXMSm">logo</a><section class="TopNav__Section-sc-aybce4-4 kPhsbm"><a href="/docs" class="TopNav__MenuLink-sc-aybce4-5 bVwmPO">Docs</a><a href="https://github.com/dw3624" class="TopNav__MenuLink-sc-aybce4-5 bVwmPO">GitHub</a></section><button class="TopNav__MenuButton-sc-aybce4-6 jzhnFu"><svg width="16" height="10" viewBox="0 0 16 10" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="16" height="2" fill="var(--black)"></rect><rect y="4" width="16" height="2" fill="var(--black)"></rect><rect y="8" width="16" height="2" fill="var(--black)"></rect></svg></button></div></nav></header><div class="_app__WrapPage-sc-xx91a-1 dzjNyc"><div class="_app__WrapMain-sc-xx91a-2 gKXBvV"><div class="_app__Main-sc-xx91a-3 iqkLbd"><div class="_app__Date-sc-xx91a-9 lhsOaa">2022-07-05</div><div class="_app__Title-sc-xx91a-7 HOFWV">PythonAnywhere 사용한 이메일봇 만들기</div><p class="_app__Desc-sc-xx91a-8 cZapZk"></p><div class="tag__Wrap-sc-wv7zn5-0 eHjIcj"><button class="tag__StyledTag-sc-17z8z5z-0 kNkMPs">python</button></div><div class="_app__Separator-sc-xx91a-10 jqpViC"></div><article><h1 class="jsx-3251069789 heading"><div id="pythonanywhere-화재발생현황-저장하고-이메일로-전송" class="jsx-3251069789"></div>PythonAnywhere 화재발생현황 저장하고 이메일로 전송</h1><a href="#개요" class="jsx-1786922009"><h2 class="jsx-3251069789 heading"><div id="개요" class="jsx-3251069789"></div>개요</h2></a><p><a href="https://nfds.go.kr/dashboard/monitor.do">국가화재정보시스템</a>이 제공하는 화재발생현황는 날짜가 바뀌면 전날 데이터를 볼 수 없음. 이에 매일 정해진 시간에 자동으로 데이터를 저장, 전송하는 웹앱을 작성함.</p><p>크롤링 및 메일 전송 코드는 Python으로 작성함. 크롤링한 데이터는 excel로 변환해 xlsx 형태로 저장 후 메일 첨부해 전송. Python 코드상으로 gmail 로그인시 403 Forbidden 문제 발생. google 2단계인증 후 앱 비밀번호 이용. (참고 : https://support.google.com/mail/answer/14257, https://gomest.tistory.com/31)</p><p>호스팅은 PythonAnywhere를 사용. 무료계정이 접근할 수 있는 사이트가 제한돼있어 유료 플랜($5/달)으로 업그레이드. (참고 : https://help.pythonanywhere.com/pages/403ForbiddenError/)</p><a href="#목표" class="jsx-1786922009"><h2 class="jsx-3251069789 heading"><div id="목표" class="jsx-3251069789"></div>목표</h2></a><p>매일 23:57에 <a href="https://nfds.go.kr/dashboard/monitor.do">국가화재정보시스템</a>의 화재발생현황(서울, 경기)을 크롤링, 엑셀로 만든 뒤 특정 사용자에게 이메일로 전송하기</p><a href="#pythonanywhere" class="jsx-1786922009"><h2 class="jsx-3251069789 heading"><div id="pythonanywhere" class="jsx-3251069789"></div>PythonAnywhere</h2></a><ul><li>Python으로 작성한 Web 프로그램을 배포해주는 무료호스팅 서비스</li></ul><a href="#코드" class="jsx-1786922009"><h2 class="jsx-3251069789 heading"><div id="코드" class="jsx-3251069789"></div>코드</h2></a><a href="#메일전송" class="jsx-1786922009"><h3 class="jsx-3251069789 heading"><div id="메일전송" class="jsx-3251069789"></div>메일전송</h3></a><div aria-live="polite" class="jsx-831781359 code"><pre class="jsx-831781359 language-python">import smtplib, ssl
from email.header import Header
from email.mime.text import MIMEText
from email.mime.multipart import MIMEMultipart
from email.mime.application import MIMEApplication


# SMTP認証情報
account = &quot;sobanghz@gmail.com&quot;
password = &quot;salzgpbgrbrzlrsd&quot;

# 送受信先
to_email = &quot;dw3624@gmail.com, monica0797@naver.com&quot;
from_email = &quot;sobanghz@gmail.com&quot;


# MIMEの作成
msg = MIMEMultipart()

subject = &#x27;화재발생현황&#x27;
msg[&quot;Subject&quot;] = Header(subject, charset=&#x27;utf-8&#x27;)
msg[&quot;To&quot;] = to_email
msg[&quot;From&quot;] = from_email

message = f&#x27;{date_ymdhm} 기준 화재발생 현황입니다.&#x27;
body = MIMEText(message, _charset=&#x27;utf-8&#x27;)
msg.attach(body)

# 파일첨부
file = f&#x27;{date_ymdhm}.xlsx&#x27;
with open(file, &#x27;rb&#x27;) as fd:
    part = MIMEApplication(fd.read())
    part.add_header(&#x27;Content-Disposition&#x27;,&#x27;attachment&#x27;,filename=file)
    msg.attach(part)

server = smtplib.SMTP_SSL(&quot;smtp.gmail.com&quot;, 465, context=ssl.create_default_context())
server.login(account, password)
server.send_message(msg)
server.quit()
print(&#x27;mail sent!&#x27;)
</pre><button class="jsx-831781359"><span class="jsx-4199775075 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><title>Copy</title><rect x="128" y="128" width="336" height="336" rx="57" ry="57" fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32"></rect><path d="M383.5 128l.5-24a56.16 56.16 0 00-56-56H112a64.19 64.19 0 00-64 64v216a56.16 56.16 0 0056 56h24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path></svg></span></button></div><a href="#크롤링" class="jsx-1786922009"><h3 class="jsx-3251069789 heading"><div id="크롤링" class="jsx-3251069789"></div>크롤링</h3></a><div aria-live="polite" class="jsx-831781359 code"><pre class="jsx-831781359 language-python">import requests
import pandas as pd
import json


import pytz
from datetime import datetime
KST = pytz.timezone(&#x27;Asia/Seoul&#x27;)
date_ymdhm = datetime.now(KST).strftime(&#x27;%Y-%m-%d_%H시%M분&#x27;)
print(date_ymdhm)


url = &#x27;https://nfds.go.kr/dashboard/monitorData.do&#x27;
proxyDict = {
    &#x27;http&#x27;  : &quot;add http proxy&quot;,
    &#x27;https&#x27; : &quot;add https proxy&quot;
}

# 서울
payload = {&#x27;sidoCode&#x27;: &#x27;11&#x27;}
res_su = requests.post(url, data=payload)
result_su = json.loads(res_su.text)

# 경기
payload = {&#x27;sidoCode&#x27;: &#x27;41&#x27;}
res_gg = requests.post(url, data=payload)
result_gg = json.loads(res_gg.text)

# 서울 + 경기
df_su = pd.DataFrame(result_su[&#x27;defail&#x27;])
df_gg = pd.DataFrame(result_gg[&#x27;defail&#x27;])
df_sg = pd.concat([df_su, df_gg])

# 정렬
df_sg = df_sg[[
    &#x27;sidoNm&#x27;, &#x27;cntrNm&#x27;, &#x27;overDate&#x27;,
    &#x27;dethNum&#x27;, &#x27;injuNum&#x27;, &#x27;expMount&#x27;,
    &#x27;addr&#x27;, &#x27;progressNm&#x27;, &#x27;frfalTypeCd&#x27;,
]]
df_sg.columns = [
    &#x27;지역&#x27;,&#x27;소방서&#x27;,&#x27;일시&#x27;,
    &#x27;사망&#x27;,&#x27;부상&#x27;,&#x27;재산피해(천원)&#x27;,
    &#x27;주소&#x27;,&#x27;진행&#x27;,&#x27;결과&#x27;
]
df_sg = df_sg.sort_values(&#x27;일시&#x27;, ascending=False)

# 엑셀 저장
df_sg.to_excel(f&#x27;{date_ymdhm}.xlsx&#x27;, encoding=&#x27;utf-8-sig&#x27;, index=False)
print(&#x27;excel saved!&#x27;)
</pre><button class="jsx-831781359"><span class="jsx-4199775075 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><title>Copy</title><rect x="128" y="128" width="336" height="336" rx="57" ry="57" fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32"></rect><path d="M383.5 128l.5-24a56.16 56.16 0 00-56-56H112a64.19 64.19 0 00-64 64v216a56.16 56.16 0 0056 56h24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path></svg></span></button></div><a href="#전체-코드" class="jsx-1786922009"><h3 class="jsx-3251069789 heading"><div id="전체-코드" class="jsx-3251069789"></div>전체 코드</h3></a><div aria-live="polite" class="jsx-831781359 code"><pre class="jsx-831781359 language-python">import requests
import pandas as pd
import json

import smtplib, ssl
from email.header import Header
from email.mime.text import MIMEText
from email.mime.multipart import MIMEMultipart
from email.mime.application import MIMEApplication

import pytz
from datetime import datetime
KST = pytz.timezone(&#x27;Asia/Seoul&#x27;)
date_ymdhm = datetime.now(KST).strftime(&#x27;%Y-%m-%d_%H시%M분&#x27;)
print(date_ymdhm)

# SMTP認証情報
account = &quot;sobanghz@gmail.com&quot;
password = &quot;salzgpbgrbrzlrsd&quot;

# 送受信先
to_email = &quot;dw3624@gmail.com, monica0797@naver.com&quot;
from_email = &quot;sobanghz@gmail.com&quot;


##################### 크롤링코드 ###################################
url = &#x27;https://nfds.go.kr/dashboard/monitorData.do&#x27;
proxyDict = {
    &#x27;http&#x27;  : &quot;add http proxy&quot;,
    &#x27;https&#x27; : &quot;add https proxy&quot;
}

# 서울
payload = {&#x27;sidoCode&#x27;: &#x27;11&#x27;}
res_su = requests.post(url, data=payload)
result_su = json.loads(res_su.text)

# 경기
payload = {&#x27;sidoCode&#x27;: &#x27;41&#x27;}
res_gg = requests.post(url, data=payload)
result_gg = json.loads(res_gg.text)

# 서울 + 경기
df_su = pd.DataFrame(result_su[&#x27;defail&#x27;])
df_gg = pd.DataFrame(result_gg[&#x27;defail&#x27;])
df_sg = pd.concat([df_su, df_gg])

# 정렬
df_sg = df_sg[[
    &#x27;sidoNm&#x27;, &#x27;cntrNm&#x27;, &#x27;overDate&#x27;,
    &#x27;dethNum&#x27;, &#x27;injuNum&#x27;, &#x27;expMount&#x27;,
    &#x27;addr&#x27;, &#x27;progressNm&#x27;, &#x27;frfalTypeCd&#x27;,
]]
df_sg.columns = [
    &#x27;지역&#x27;,&#x27;소방서&#x27;,&#x27;일시&#x27;,
    &#x27;사망&#x27;,&#x27;부상&#x27;,&#x27;재산피해(천원)&#x27;,
    &#x27;주소&#x27;,&#x27;진행&#x27;,&#x27;결과&#x27;
]
df_sg = df_sg.sort_values(&#x27;일시&#x27;, ascending=False)

# 엑셀 저장
df_sg.to_excel(f&#x27;{date_ymdhm}.xlsx&#x27;, encoding=&#x27;utf-8-sig&#x27;, index=False)
print(&#x27;excel saved!&#x27;)

##################################################################

# MIMEの作成
msg = MIMEMultipart()

subject = &#x27;화재발생현황&#x27;
msg[&quot;Subject&quot;] = Header(subject, charset=&#x27;utf-8&#x27;)
msg[&quot;To&quot;] = to_email
msg[&quot;From&quot;] = from_email

message = f&#x27;{date_ymdhm} 기준 화재발생 현황입니다.&#x27;
body = MIMEText(message, _charset=&#x27;utf-8&#x27;)
msg.attach(body)

# 파일첨부
file = f&#x27;{date_ymdhm}.xlsx&#x27;
with open(file, &#x27;rb&#x27;) as fd:
    part = MIMEApplication(fd.read())
    part.add_header(&#x27;Content-Disposition&#x27;,&#x27;attachment&#x27;,filename=file)
    msg.attach(part)

server = smtplib.SMTP_SSL(&quot;smtp.gmail.com&quot;, 465, context=ssl.create_default_context())
server.login(account, password)
server.send_message(msg)
server.quit()
print(&#x27;mail sent!&#x27;)
</pre><button class="jsx-831781359"><span class="jsx-4199775075 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><title>Copy</title><rect x="128" y="128" width="336" height="336" rx="57" ry="57" fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32"></rect><path d="M383.5 128l.5-24a56.16 56.16 0 00-56-56H112a64.19 64.19 0 00-64 64v216a56.16 56.16 0 0056 56h24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path></svg></span></button></div></article></div><div class="_app__ToC-sc-xx91a-4 jecWPd"><nav class="jsx-2743484325 toc"><ul class="jsx-2743484325 flex column"><li class="jsx-2743484325 "><a class="jsx-2743484325" href="/docs/220705-nfds-email-bot#%EA%B0%9C%EC%9A%94">개요</a></li><li class="jsx-2743484325 "><a class="jsx-2743484325" href="/docs/220705-nfds-email-bot#%EB%AA%A9%ED%91%9C">목표</a></li><li class="jsx-2743484325 "><a class="jsx-2743484325" href="/docs/220705-nfds-email-bot#pythonanywhere">PythonAnywhere</a></li><li class="jsx-2743484325 "><a class="jsx-2743484325" href="/docs/220705-nfds-email-bot#%EC%BD%94%EB%93%9C">코드</a></li><li class="jsx-2743484325 padded"><a class="jsx-2743484325" href="/docs/220705-nfds-email-bot#%EB%A9%94%EC%9D%BC%EC%A0%84%EC%86%A1">메일전송</a></li><li class="jsx-2743484325 padded"><a class="jsx-2743484325" href="/docs/220705-nfds-email-bot#%ED%81%AC%EB%A1%A4%EB%A7%81">크롤링</a></li><li class="jsx-2743484325 padded"><a class="jsx-2743484325" href="/docs/220705-nfds-email-bot#%EC%A0%84%EC%B2%B4-%EC%BD%94%EB%93%9C">전체 코드</a></li></ul></nav></div></div></div></div><footer class="Footer__Wrap-sc-ifmyi6-0 fuJDY"><footer class="Footer__Foot-sc-ifmyi6-1 gBtbfS"><div class="Footer__Item-sc-ifmyi6-2 jmqRFP">Nice to meet you!</div><div class="Footer__Item-sc-ifmyi6-2 jmqRFP">©2022. dw3624 All rights reserved.</div></footer></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"markdoc":{"content":{"$$mdtype":"Tag","name":"article","attributes":{},"children":[{"$$mdtype":"Tag","name":"Heading","attributes":{"level":1,"id":"pythonanywhere-화재발생현황-저장하고-이메일로-전송"},"children":["PythonAnywhere 화재발생현황 저장하고 이메일로 전송"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":2,"id":"개요"},"children":["개요"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"a","attributes":{"href":"https://nfds.go.kr/dashboard/monitor.do"},"children":["국가화재정보시스템"]},"이 제공하는 화재발생현황는 날짜가 바뀌면 전날 데이터를 볼 수 없음. 이에 매일 정해진 시간에 자동으로 데이터를 저장, 전송하는 웹앱을 작성함."]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["크롤링 및 메일 전송 코드는 Python으로 작성함. 크롤링한 데이터는 excel로 변환해 xlsx 형태로 저장 후 메일 첨부해 전송. Python 코드상으로 gmail 로그인시 403 Forbidden 문제 발생. google 2단계인증 후 앱 비밀번호 이용. (참고 : https://support.google.com/mail/answer/14257, https://gomest.tistory.com/31)"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["호스팅은 PythonAnywhere를 사용. 무료계정이 접근할 수 있는 사이트가 제한돼있어 유료 플랜($5/달)으로 업그레이드. (참고 : https://help.pythonanywhere.com/pages/403ForbiddenError/)"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":2,"id":"목표"},"children":["목표"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["매일 23:57에 ",{"$$mdtype":"Tag","name":"a","attributes":{"href":"https://nfds.go.kr/dashboard/monitor.do"},"children":["국가화재정보시스템"]},"의 화재발생현황(서울, 경기)을 크롤링, 엑셀로 만든 뒤 특정 사용자에게 이메일로 전송하기"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":2,"id":"pythonanywhere"},"children":["PythonAnywhere"]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":["Python으로 작성한 Web 프로그램을 배포해주는 무료호스팅 서비스"]}]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":2,"id":"코드"},"children":["코드"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"메일전송"},"children":["메일전송"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"python"},"children":["import smtplib, ssl\nfrom email.header import Header\nfrom email.mime.text import MIMEText\nfrom email.mime.multipart import MIMEMultipart\nfrom email.mime.application import MIMEApplication\n\n\n# SMTP認証情報\naccount = \"sobanghz@gmail.com\"\npassword = \"salzgpbgrbrzlrsd\"\n\n# 送受信先\nto_email = \"dw3624@gmail.com, monica0797@naver.com\"\nfrom_email = \"sobanghz@gmail.com\"\n\n\n# MIMEの作成\nmsg = MIMEMultipart()\n\nsubject = '화재발생현황'\nmsg[\"Subject\"] = Header(subject, charset='utf-8')\nmsg[\"To\"] = to_email\nmsg[\"From\"] = from_email\n\nmessage = f'{date_ymdhm} 기준 화재발생 현황입니다.'\nbody = MIMEText(message, _charset='utf-8')\nmsg.attach(body)\n\n# 파일첨부\nfile = f'{date_ymdhm}.xlsx'\nwith open(file, 'rb') as fd:\n    part = MIMEApplication(fd.read())\n    part.add_header('Content-Disposition','attachment',filename=file)\n    msg.attach(part)\n\nserver = smtplib.SMTP_SSL(\"smtp.gmail.com\", 465, context=ssl.create_default_context())\nserver.login(account, password)\nserver.send_message(msg)\nserver.quit()\nprint('mail sent!')\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"크롤링"},"children":["크롤링"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"python"},"children":["import requests\nimport pandas as pd\nimport json\n\n\nimport pytz\nfrom datetime import datetime\nKST = pytz.timezone('Asia/Seoul')\ndate_ymdhm = datetime.now(KST).strftime('%Y-%m-%d_%H시%M분')\nprint(date_ymdhm)\n\n\nurl = 'https://nfds.go.kr/dashboard/monitorData.do'\nproxyDict = {\n    'http'  : \"add http proxy\",\n    'https' : \"add https proxy\"\n}\n\n# 서울\npayload = {'sidoCode': '11'}\nres_su = requests.post(url, data=payload)\nresult_su = json.loads(res_su.text)\n\n# 경기\npayload = {'sidoCode': '41'}\nres_gg = requests.post(url, data=payload)\nresult_gg = json.loads(res_gg.text)\n\n# 서울 + 경기\ndf_su = pd.DataFrame(result_su['defail'])\ndf_gg = pd.DataFrame(result_gg['defail'])\ndf_sg = pd.concat([df_su, df_gg])\n\n# 정렬\ndf_sg = df_sg[[\n    'sidoNm', 'cntrNm', 'overDate',\n    'dethNum', 'injuNum', 'expMount',\n    'addr', 'progressNm', 'frfalTypeCd',\n]]\ndf_sg.columns = [\n    '지역','소방서','일시',\n    '사망','부상','재산피해(천원)',\n    '주소','진행','결과'\n]\ndf_sg = df_sg.sort_values('일시', ascending=False)\n\n# 엑셀 저장\ndf_sg.to_excel(f'{date_ymdhm}.xlsx', encoding='utf-8-sig', index=False)\nprint('excel saved!')\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"전체-코드"},"children":["전체 코드"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"python"},"children":["import requests\nimport pandas as pd\nimport json\n\nimport smtplib, ssl\nfrom email.header import Header\nfrom email.mime.text import MIMEText\nfrom email.mime.multipart import MIMEMultipart\nfrom email.mime.application import MIMEApplication\n\nimport pytz\nfrom datetime import datetime\nKST = pytz.timezone('Asia/Seoul')\ndate_ymdhm = datetime.now(KST).strftime('%Y-%m-%d_%H시%M분')\nprint(date_ymdhm)\n\n# SMTP認証情報\naccount = \"sobanghz@gmail.com\"\npassword = \"salzgpbgrbrzlrsd\"\n\n# 送受信先\nto_email = \"dw3624@gmail.com, monica0797@naver.com\"\nfrom_email = \"sobanghz@gmail.com\"\n\n\n##################### 크롤링코드 ###################################\nurl = 'https://nfds.go.kr/dashboard/monitorData.do'\nproxyDict = {\n    'http'  : \"add http proxy\",\n    'https' : \"add https proxy\"\n}\n\n# 서울\npayload = {'sidoCode': '11'}\nres_su = requests.post(url, data=payload)\nresult_su = json.loads(res_su.text)\n\n# 경기\npayload = {'sidoCode': '41'}\nres_gg = requests.post(url, data=payload)\nresult_gg = json.loads(res_gg.text)\n\n# 서울 + 경기\ndf_su = pd.DataFrame(result_su['defail'])\ndf_gg = pd.DataFrame(result_gg['defail'])\ndf_sg = pd.concat([df_su, df_gg])\n\n# 정렬\ndf_sg = df_sg[[\n    'sidoNm', 'cntrNm', 'overDate',\n    'dethNum', 'injuNum', 'expMount',\n    'addr', 'progressNm', 'frfalTypeCd',\n]]\ndf_sg.columns = [\n    '지역','소방서','일시',\n    '사망','부상','재산피해(천원)',\n    '주소','진행','결과'\n]\ndf_sg = df_sg.sort_values('일시', ascending=False)\n\n# 엑셀 저장\ndf_sg.to_excel(f'{date_ymdhm}.xlsx', encoding='utf-8-sig', index=False)\nprint('excel saved!')\n\n##################################################################\n\n# MIMEの作成\nmsg = MIMEMultipart()\n\nsubject = '화재발생현황'\nmsg[\"Subject\"] = Header(subject, charset='utf-8')\nmsg[\"To\"] = to_email\nmsg[\"From\"] = from_email\n\nmessage = f'{date_ymdhm} 기준 화재발생 현황입니다.'\nbody = MIMEText(message, _charset='utf-8')\nmsg.attach(body)\n\n# 파일첨부\nfile = f'{date_ymdhm}.xlsx'\nwith open(file, 'rb') as fd:\n    part = MIMEApplication(fd.read())\n    part.add_header('Content-Disposition','attachment',filename=file)\n    msg.attach(part)\n\nserver = smtplib.SMTP_SSL(\"smtp.gmail.com\", 465, context=ssl.create_default_context())\nserver.login(account, password)\nserver.send_message(msg)\nserver.quit()\nprint('mail sent!')\n"]}]},"frontmatter":{"title":"PythonAnywhere 사용한 이메일봇 만들기","date":"2022-07-05","tags":"python"},"file":{"path":"/docs/220705-nfds-email-bot.md"}}},"__N_SSG":true},"page":"/docs/220705-nfds-email-bot","query":{},"buildId":"gXFg2fmxjtWa03NholGib","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>